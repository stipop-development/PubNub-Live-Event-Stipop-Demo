# Mux Embed

The embed code and included JavaScript file for browser-based analytics tracking.

## Setup

Install dependencies

```
yarn install
```

## Prepublish

Build the useable files into the `dist` folder, after running linting and tests

```
yarn run package
```

## Publishing

> Be sure to bump the version in the package.json in the PR before merging to master. This should be done via:

```
yarn version
```

> Make sure to push this to github, including the accompanying tag.

### S3

Publishing to the mux-sdks S3 bucket happens automatically when pull requests are merged into master.
See `scripts/deploy.js` for specifics.

### Cloudfront

After the automatic deploy to S3, the Cloudfront distribution needs to be invalidated for the
major version path (e.g. src.litix.io/core/major_version/mux.js).

### NPM

In order to publish the new version to NPM, you must build it from scratch then publish it.

```
yarn run package
yarn publish
```

## Testing

To run the tests locally, just run
```
yarn run test
```

To run the tests through SauceLabs (locally). You must have SAUCE_USERNAME and SAUCE_ACCESS_KEY configured as environment variables:
```
SAUCELABS=1 yarn run test
```

Protip #1 - to run tests locally without launching all the browsers change this line in karma.conf. Don't commit this change, but
it chan be handy when running things locally that you don't want to test in every browser.

```diff
- frameworks: ['mocha', 'detectBrowsers'],
+ frameworks: ['mocha'],
```

Protip #2 use karma's `describe.only` syntax to only run a certain block of tests

## linting

This uses ESLint for linting, so to run linting standalone, run:
```
yarn run lint
```

## Developing

To watch the lib and test folders for any changes, run lint, test, and build
sequentially, and start the server (default port 8080 or first one free after):
```
yarn start
```

## Files

### dist/mux.js
The minified version of mux.js. This file is loaded into the web page by the embed code.
For every event that is tracked it will send a beacon to the server.
The beacon is simply an image URL with data in the query string.

## Using

See [docs.mux.io](http://docs.mux.io) for usage details (and don't forget to update the docs if you make changes).
